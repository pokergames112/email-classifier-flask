<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificador de E-mail IA (v2)</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background-color: #f4f4f4; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        textarea { width: 100%; height: 200px; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; resize: vertical; }
        input[type="file"] { padding: 10px; border: 1px solid #ddd; border-radius: 4px; width: 100%; box-sizing: border-box; }
        button { padding: 10px 20px; cursor: pointer; background-color: #28a745; color: white; border: none; border-radius: 5px; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #218838; }
        .result-box { margin-top: 30px; padding: 15px; border: 2px solid #28a745; background-color: #e6ffed; border-radius: 6px; }
        #categoria { font-weight: bold; color: #007bff; font-size: 1.1em; }
        #loading { color: #007bff; font-weight: bold; margin-top: 15px; }
        #error_message { color: red; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

    <h1>Classificador e Sugestor de Respostas</h1>
    <p>Analise e classifique e-mails usando IA de código aberto.</p>

    <form id="emailForm" enctype="multipart/form-data"> 
        
        <h2>1. Insira o E-mail ou Faça Upload</h2>
        
        <div class="input-group">
            <label for="email_file">Fazer Upload do E-mail (.txt ou .pdf):</label>
            <input type="file" id="email_file" name="email_file" accept=".txt,.pdf">
        </div>
        
        <div class="input-group">
            <label for="email_content">Ou Cole o Conteúdo do E-mail Aqui:</label>
            <textarea id="email_content" name="email_content" rows="10" placeholder="Cole o texto completo do e-mail..."></textarea>
        </div>
        
        <button type="submit">Classificar E-mail</button>
        
        <div id="loading" style="display: none;">Processando...</div>
    </form>

    <div class="result-box">
        <h2>2. Resultado da Análise</h2>
        <p><strong>Categoria:</strong> <span id="categoria">Aguardando análise...</span></p>
        <p><strong>Resposta Sugerida:</strong></p>
        <textarea id="resposta_sugerida" rows="5" readonly></textarea>
        <button onclick="copiarResposta()">Copiar Resposta</button>
    </div>
    
    <p id="error_message" style="display: none;"></p>

    <script>
        const form = document.getElementById('emailForm'); // Novo ID do form
        const categoriaSpan = document.getElementById('categoria');
        const respostaArea = document.getElementById('resposta_sugerida');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error_message');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);

            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            categoriaSpan.textContent = 'Processando...';
            respostaArea.value = 'Aguarde, a IA está analisando...';

            try {
                // Envia o FormData, que pode conter texto OU arquivo
                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData 
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.error) {
                        // Trata erro retornado pelo Python (ex: arquivo vazio)
                        errorDiv.innerText = data.error;
                        errorDiv.style.display = 'block';
                        categoriaSpan.textContent = 'Falha';
                        respostaArea.value = '';
                    } else {
                        // Sucesso
                        categoriaSpan.textContent = data.categoria;
                        respostaArea.value = data.resposta_sugerida;
                    }
                } else {
                    // Trata erros de rede ou status HTTP (400, 500)
                    errorDiv.innerText = `Erro HTTP: ${response.status}. ${data.error || 'Ocorreu um erro no servidor.'}`;
                    errorDiv.style.display = 'block';
                    categoriaSpan.textContent = 'Erro';
                    respostaArea.value = '';
                }

            } catch (error) {
                errorDiv.innerText = 'Erro ao conectar com o servidor Flask.';
                errorDiv.style.display = 'block';
                categoriaSpan.textContent = 'Erro de Conexão';
                respostaArea.value = '';
                console.error('Fetch error:', error);
            } finally {
                loadingDiv.style.display = 'none';
            }
        });
        
        // Função de copiar
        function copiarResposta() {
            respostaArea.select();
            document.execCommand('copy');
            alert('Resposta copiada para a área de transferência!');
        }
    </script>
</body>
</html>